/* Metrowerks Standard Library * Copyright © 1995-2002 Metrowerks Corporation.  All rights reserved. * * $Date: 2002/02/14 17:52:12 $ * $Revision: 1.16 $ *//* *	Routines *	-------- *		__sys_alloc *		__sys_free * *	Note *	---- * *		These routines, being platform-specific, were split off of pool_alloc.c. *//* ERZ, make memory allocation threadsafe */#undef _MSL_THREADSAFE#define _MSL_THREADSAFE 1#include <ansi_parms.h>#include <pool_alloc.h>#include <stdlib.h>#if __MACH__	#include <Carbon/Carbon.h>#else	#if _MSL_THREADSAFE		#include <Multiprocessing.h>	/*- JWW 010426 -*/	#else		#include <MacMemory.h>	/*- vss 990421 -*/	#endif#endif#ifndef __SYS_ALLOC	#define __SYS_ALLOC __sys_alloc#endif#ifndef __SYS_FREE	#define __SYS_FREE __sys_free#endif#if !(defined(_MSL_CLASSIC_MALLOC) || defined(_MSL_PRO4_MALLOC))void * __SYS_ALLOC(size_t size){#if _MSL_THREADSAFE	return MPAllocateAligned(size, kMPAllocate16ByteAligned, 0);	/*- JWW 010426 -*/#else	return NewPtr(size);#endif}void __SYS_FREE(void *ptr){#if _MSL_THREADSAFE	MPFree(ptr);	/*- JWW 010426 -*/#else	DisposePtr(ptr);#endif}size_t __sys_pointer_size(void* ptr){#if _MSL_THREADSAFE	return MPGetAllocatedBlockSize(ptr);	/*- JWW 010426 -*/#else	return GetPtrSize(ptr);#endif}#else /* _MSL_CLASSIC_MALLOC */#pragma warn_unusedarg offvoid * __SYS_ALLOC(mem_size size, mem_pool_obj* poolObj){#if _MSL_THREADSAFE	return MPAllocateAligned(size, kMPAllocate16ByteAligned, 0);	/*- JWW 010426 -*/#else	return NewPtr(size);#endif}void __SYS_FREE(void *ptr, mem_pool_obj* poolObj){#if _MSL_THREADSAFE	MPFree(ptr);	/*- JWW 010426 -*/#else	DisposePtr(ptr);#endif}#pragma warn_unusedarg reset#endif/* Change record: * JFH 950918 First code release. * JFH 951012 Moved #include of <Memory.h> from pool_alloc.c * JFH 960122 Added casts from (void *) for C++ compatibility. * JG  980129 Added heap registration support, for ZoneRanger * JG  980305 Check for process mgr before calling it, in case this is INIT time * hh  990409 Added __SYS_ALLOC hook for overriding. * vss 990121 Update to 3.2 Universal Headers * ra  000215 Removed ZR support, but left _MSL_PRO4_MALLOC support * hh  000523 Added __sys_pointer_size * JWW 010426 Added in Multiprocessing MPAllocateAligned/MPFree routines for obtaining memory * JWW 011027 Added case for Mach-O * JWW 020130 Changed _MWMT to _MSL_THREADSAFE for consistency's sake * hh  020214 Renamed _MSL_PRO4_MALLOC to _MSL_CLASSIC_MALLOC */